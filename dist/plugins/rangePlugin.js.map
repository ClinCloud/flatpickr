{"version":3,"file":"rangePlugin.js","sources":["../../src/plugins/rangePlugin.ts"],"sourcesContent":["import { Plugin } from \"../types/options\";\n\nexport interface Config {\n  input?: string | HTMLInputElement;\n  position?: \"left\";\n}\n\ndeclare global {\n  interface Window {\n    rangePlugin: (config?: Config) => void;\n  }\n}\n\nfunction rangePlugin(config: Config = {}): Plugin {\n  return function(fp) {\n    let dateFormat = \"\",\n      secondInput: HTMLInputElement,\n      _secondInputFocused: boolean,\n      _prevDates: Date[];\n\n    const createSecondInput = () => {\n      if (config.input) {\n        secondInput =\n          config.input instanceof Element\n            ? config.input\n            : (window.document.querySelector(config.input) as HTMLInputElement);\n\n        if (!secondInput) {\n          fp.config.errorHandler(new Error(\"Invalid input element specified\"));\n          return;\n        }\n\n        if (fp.config.wrap) {\n          secondInput = secondInput.querySelector(\n            \"[data-input]\"\n          ) as HTMLInputElement;\n        }\n      } else {\n        secondInput = fp._input.cloneNode() as HTMLInputElement;\n        secondInput.removeAttribute(\"id\");\n        secondInput._flatpickr = undefined;\n      }\n\n      if (secondInput.value) {\n        const parsedDate = fp.parseDate(secondInput.value);\n\n        if (parsedDate) fp.selectedDates.push(parsedDate);\n      }\n\n      secondInput.setAttribute(\"data-fp-omit\", \"\");\n\n      fp._bind(secondInput, [\"focus\", \"click\"], () => {\n        if (fp.selectedDates[1]) {\n          fp.latestSelectedDateObj = fp.selectedDates[1];\n          fp._setHoursFromDate(fp.selectedDates[1]);\n          fp.jumpToDate(fp.selectedDates[1]);\n        }\n\n        _secondInputFocused = true;\n        fp.isOpen = false;\n        fp.open(\n          undefined,\n          config.position === \"left\" ? fp._input : secondInput\n        );\n      });\n\n      fp._bind(fp._input, [\"focus\", \"click\"], (e: FocusEvent) => {\n        e.preventDefault();\n        fp.isOpen = false;\n        fp.open();\n      });\n\n      if (fp.config.allowInput)\n        fp._bind(secondInput, \"keydown\", (e: KeyboardEvent) => {\n          if ((e as KeyboardEvent).key === \"Enter\") {\n            fp.setDate(\n              [fp.selectedDates[0], secondInput.value],\n              true,\n              dateFormat\n            );\n            secondInput.click();\n          }\n        });\n\n      if (!config.input)\n        fp._input.parentNode &&\n          fp._input.parentNode.insertBefore(secondInput, fp._input.nextSibling);\n    };\n\n    const plugin = {\n      onParseConfig() {\n        fp.config.mode = \"range\";\n\n        dateFormat = fp.config.altInput\n          ? fp.config.altFormat\n          : fp.config.dateFormat;\n      },\n\n      onReady() {\n        createSecondInput();\n        fp.config.ignoredFocusElements.push(secondInput);\n        if (fp.config.allowInput) {\n          fp._input.removeAttribute(\"readonly\");\n          secondInput.removeAttribute(\"readonly\");\n        } else {\n          secondInput.setAttribute(\"readonly\", \"readonly\");\n        }\n\n        fp._bind(fp._input, \"focus\", () => {\n          fp.latestSelectedDateObj = fp.selectedDates[0];\n          fp._setHoursFromDate(fp.selectedDates[0]);\n          _secondInputFocused = false;\n          fp.jumpToDate(fp.selectedDates[0]);\n        });\n\n        if (fp.config.allowInput)\n          fp._bind(fp._input, \"keydown\", (e: KeyboardEvent) => {\n            if ((e as KeyboardEvent).key === \"Enter\")\n              fp.setDate(\n                [fp._input.value, fp.selectedDates[1]],\n                true,\n                dateFormat\n              );\n          });\n\n        fp.setDate(fp.selectedDates, false);\n        plugin.onValueUpdate(fp.selectedDates);\n        fp.loadedPlugins.push(\"range\");\n      },\n\n      onPreCalendarPosition() {\n        if (_secondInputFocused) {\n          fp._positionElement = secondInput;\n          setTimeout(() => {\n            fp._positionElement = fp._input;\n          }, 0);\n        }\n      },\n\n      onChange() {\n        if (!fp.selectedDates.length) {\n          setTimeout(() => {\n            if (fp.selectedDates.length) return;\n\n            secondInput.value = \"\";\n            _prevDates = [];\n          }, 10);\n        }\n\n        if (_secondInputFocused) {\n          setTimeout(() => {\n            secondInput.focus();\n          }, 0);\n        }\n      },\n\n      onDestroy() {\n        if (!config.input)\n          secondInput.parentNode &&\n            secondInput.parentNode.removeChild(secondInput);\n      },\n\n      onValueUpdate(selDates: Date[]) {\n        if (!secondInput) return;\n\n        _prevDates =\n          !_prevDates || selDates.length >= _prevDates.length\n            ? [...selDates]\n            : _prevDates;\n\n        if (_prevDates.length > selDates.length) {\n          const newSelectedDate = selDates[0];\n          const newDates = _secondInputFocused\n            ? [_prevDates[0], newSelectedDate]\n            : [newSelectedDate, _prevDates[1]];\n\n          fp.setDate(newDates, false);\n          _prevDates = [...newDates];\n        }\n\n        [fp._input.value = \"\", secondInput.value = \"\"] = fp.selectedDates.map(\n          d => fp.formatDate(d, dateFormat)\n        );\n      },\n    };\n\n    return plugin;\n  };\n}\n\nexport default rangePlugin;\n"],"names":[],"mappings":"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"}